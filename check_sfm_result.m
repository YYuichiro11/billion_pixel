% このファイルでは，SfM結果を読み込んで位置姿勢の推定結果を可視化します

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% path %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% point cloud path
point_cloud_path = 'mannen2_results/option-0000.ply';

% path is the text file path generated by visualSfM
% image_folder_path is the image folder path saved as /---.nvm.cmvs/00/visualize

path = 'mannen2_results/cameras_v2.txt';
image_folder_path = '';
cam_position_path = 'mannen2_results/centers-all.ply';

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
pointcloud = pcread(point_cloud_path);
camera_position = pcread(cam_position_path);

camera_params = read_vsfm(path);
cam_param1 = camera_params(1);

% cpselect(camera_params(base_image_id).image, camera_params(base_image_id+1).image);

% カメラの位置姿勢をベクトルで表します
x = zeros(camera_params.Count,1);
y = zeros(camera_params.Count,1);
z = zeros(camera_params.Count,1);
u = zeros(camera_params.Count,1);
v = zeros(camera_params.Count,1);
w = zeros(camera_params.Count,1);

for a = 1:camera_params.Count
    x(a) = camera_params(a).camera_position(1);
    y(a) = camera_params(a).camera_position(2);
    z(a) = camera_params(a).camera_position(3);
    u(a) = camera_params(a).rotation_matrix(3,1);
    v(a) = camera_params(a).rotation_matrix(3,2);
    w(a) = camera_params(a).rotation_matrix(3,3);
end
figure;
pcshow(pointcloud)
hold on
quiver3(x,y,z,u,v,w)
